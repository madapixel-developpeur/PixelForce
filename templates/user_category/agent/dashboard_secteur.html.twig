{% set typeSecteurId = app.session.get('typeSecteurId') %}
{% set estSecurite = typeSecteurId == constant('App\\Entity\\TypeSecteur::SECURITE') %}
{% set estDemandeDevis = typeSecteurId == constant('App\\Entity\\TypeSecteur::DEMANDE_DEVIS') %}
{% set estEcommerce = typeSecteurId == constant('App\\Entity\\TypeSecteur::ECOMMERCE') %}
{% extends 'base.html.twig' %}


{% block title %}
	Dashboard : {{ secteur.nom }}
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {{ encore_entry_link_tags('vuexy_dashboard_ecommerce') }}
    <link rel="stylesheet" href="{{asset('assets/css/stepper.css')}}">
    <link rel="stylesheet" href="{{asset('assets/css/dashboard-custom-style.css')}}">
{% endblock %}

{% block body %}
    <div class="mt-3">
        <section id="dashboard-ecommerce">
           <div class="row match-height">
                <div class="col-lg-8 col-12">
                    <h4 class=" mt-2 mb-3 choix-secteur-primary">Liste des formations</h4>
                    <div class="card ">
                        <div class="card-body p-0">
                            {% if firstFormation == null and videoFinFormation is not null %}
                                <div class="row">
                                    <div class="col-12">
                                        <div class="border ratio ratio-16x9 rounded-3">
                                            <iframe src="{{ videoFinFormation.urlVideo ~"?loop=0&byline=0&portrait=0&title=0&muted=1" }}" width="700" height="400" class="m-auto" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen allow="autoplay; encrypted-media"></iframe>
                                        </div>  
                                    </div>
                                </div>
                            {% elseif firstFormation == null %}    
                                <div class="alert alert-primary text-center m-5">
                                    Il n'y a plus de formation à terminer
                                </div>
                            {% else %}
                                {# {% if firstFormation.categorieFormation.ordreCatFormation == constant('App\\Entity\\CategorieFormation::ORDRE_LISTE_DE_CONTACT') and nbrAllMyContacts < constant('App\\Entity\\CategorieFormation::CONDITION_LISTE_DE_CONTACT') %}
                                    <h3 class="fw-bolder text-center mt-2">{{ firstFormation.titre}} </h3>    
                                    <div class="alert alert-warning m-5 text-center h2">
                                        Pour débloquer cette formation, assurez-vous d’avoir enregistré plus de 100 contacts dans votre liste de prospection.
                                    </div>
                                {% else %} #}
                                    {% set isQuiz = firstFormation.type == constant('App\\Entity\\Formation::TYPE_QUIZ') %}
                                    
                                    {% if isQuiz %}
                                    {% set formationAgentRelation = repoFormationAgent.findOneBy({agent:app.user.id, formation:firstFormation}) %}
                                    {% set statut = formationAgentRelation ? formationAgentRelation.statut : constant('App\\Entity\\Formation::STATUT_DISPONIBLE') %}
                                    <h3 class="fw-bolder text-center mt-2">QUIZ: {{ firstFormation.titre}} </h3>
                                    <div class="border bg-white px-3 py-3" style="min-height: 150px;">
                                        {% if firstFormation.description %}
                                        <p class="text-center">{{ firstFormation.description }}</p>
                                        {% endif %}
                                        
                                        {% if formationAgentRelation %}
                                        <div class="d-flex align-items-center justify-content-around mb-2">
                                        <p><b>Dernièr résultat:</b> {{formationAgentRelation.lastResultScore | number_format(2, ',', ' ')}} %</p>
                                        <p><b>Résultat maximum:</b> {{formationAgentRelation.maxResultScore | number_format(2, ',', ' ')}} %</p>
                                            
                                            <p><b>Statut:</b>&nbsp;
                                            {% if formationAgentRelation.statut == constant('App\\Entity\\Formation::STATUT_TERMINER') %}
                                            <b class="text-success">RÉUSSI</b>
                                            {% else %}
                                            <b class="text-danger">ÉCHOUÉ</b>
                                            {% endif %}
                                            </p>
                                        </div>                                  
                                        {% endif %}
                                        <div class="text-center"><i class="fa fa-question-circle fa-3x"></i></div>
                                    </div>
                                    
                                    <div class="text-center m-2 p-2">
                                        <div class="row">
                                             {% if statut == constant('App\\Entity\\Formation::STATUT_DISPONIBLE')%}
                                            <div class="col">
                                                <a href="{{ path('agent_quiz_begin', {id:firstFormation.id}) }}" class="btn btn-primary fw-bolder mt-4">Commencer</a>
                                            </div>
                                            <div class="col">
                                                
                                            </div>
                                            {% elseif statut == constant('App\\Entity\\Formation::STATUT_IN_PROGRESS') or statut == constant('App\\Entity\\Formation::STATUT_TERMINER') %}
                                            <div class="col">
                                                <a href="{{ path('agent_quiz_begin', {id:firstFormation.id}) }}" class="btn btn-primary fw-bolder mt-4"><i class="fa fa-repeat"></i> Réessayer</a>
                                            </div>
                                            <div class="col">
                                                <a href="{{ path('agent_quiz_result', {id:formationAgentRelation.id}) }}" class="btn btn-success fw-bolder mt-4"><i class="fa fa-chevron-right"></i> Voir le dérnier résultat</a>
                                            </div>
                                            {% endif %}
                                            <div class="col">
                                                <a href="{{ path('agent_formation_list') }}" class="btn btn-secondary fw-bolder mt-4"><i class="fa-solid fa-list me-2"></i> Liste des formations</a>
                                            </div>
                                        </div>
                                    </div>
                                    {% else %}
                                    <div class="row">

                                        <div class="col-12 pb-3">
                                            <div class="border ratio ratio-16x9 rounded-3">
                                                <iframe id="formationVideo" src="https://player.vimeo.com/video/{{ firstFormation.videoId }}?loop=0&byline=0&portrait=0&title=0&muted=1" width="700" height="400" class="m-auto" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen allow="autoplay; encrypted-media"></iframe>
                                            </div>  
                                            <h5 class=" text-center m-2 general-primary-text fs-5">{{ firstFormation.titre}} </h5>
                                            <div class="text-center">
                                                <div class="row">
                                                    <div class="col">
                                                        <a href="{{ path('agent_formation_fiche', {id:firstFormation.id}) }}" class="regular-button w-50 mt-2 rounded-3"><i class="fa-solid fa-file me-2"></i> Fiche formation</a>
                                                    </div>
                                                    
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    
                                   
                                    {% endif %}
                                    <form method="get" action="{{ path('agent_formation_terminer', {id:firstFormation.id}) }}" id="formFinishFormation">
                                        <input type="hidden" name="path" value="fromDashboard">
                                    </form>
                                    
                                {# {% endif %} #}
                            {% endif %}
                            
                        </div>
                    </div>
                    
                </div>
                {% if app.user.finishedOneVideoFormation  %}
                    <div class="col-lg-4 col-md-6 col-12">
                        <h4 class=" mt-2 mb-3 choix-secteur-primary only-on-large-screens" style="visibility: hidden;">&nbsp;</h4>
                        <a class="regular-button w-100 text-center mb-3" href="{{ path('agent_formation_list') }}"  id="startFormation" >Demarrer le programme</a>  
                        <a class="regular-button w-100 text-center mb-3 d-none" href="#" onclick='terminerFormation()' id="terminerFormationButton" >Terminer la formation</a>  
                        <a class="regular-button w-100 text-center mb-3" href="{{ pbb_ws_url }}">Devenir client</a>  
                        <a class="regular-button w-100 text-center mb-3" href="{{ pbb_ws_url }}">⁠Recommander des clients</a>  
                        <a class="regular-button w-100 text-center mb-3" href="{{ path('agent_view') }}"  >⁠Recommander des personnes</a>  
                        
                    </div>
                {% endif %}
                
               
            </div>

            <div class="row match-height">
                <div class="col-xl-8 col-md-6 col-12">
                    <h4 class=" mt-2 mb-3 choix-secteur-primary">Progression</h4>
                    <div class="">
                        <div class="card card-statistics p-4">
                            <div class="card-body ">
                               
                                <h5 class="  choix-secteur-primary mb-4">Formation</h5>
                                <p class="w-50">Une brève description sur le déroulement de la formation</p>
                               
                                
                                <div class="mt-4 steps formation-progression d-flex flex-wrap flex-sm-nowrap justify-content-between padding-top-2x padding-bottom-1x">
                                    {% set isCompletedBefore = true %}
                                    {% for step in formationCategoriesOrdered %}
                                    {% set isCompleted = (not firstFormation or (firstFormation and step.ordreCatFormation < firstFormation.CategorieFormation.ordreCatFormation)) %}
                                    {% set isCurrent = (isCompletedBefore and not isCompleted) %}
                                    <div class="step {% if isCompleted %} completed {% endif %}">
                                        <div class="step-icon-wrap">
                                        <div class="step-icon">{% if isCompleted %}<i class="fa fa-check"></i>{% elseif isCurrent %}<p class="text-tableau mt-1">{{loop.index}}</p>{% else %}<i class="fa-solid fa-lock text-tableau"></i>{% endif %}</div>
                                        </div>
                                        <h4 class="step-title">{{step.nom}}</h4>
                                    </div>
                                    {% set isCompletedBefore = isCompleted %}
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% if app.user.canAccessFonct('AGENDA', app.session.get('secteurId')) %}
                    <div class="col-lg-4 col-md-6 col-12">
                    {% if expert is defined and expert is not null %}
                    
                        <h4 class=" mt-2 mb-3 choix-secteur-primary">Rendez-vous avec un expert</h4>
                        <div class="card mb-3" style="max-height:310px;">
                            <div class="card-body text-center">
                                    <div class="text-center">
                                        <img src="{{ path('user_avatar', { id:expert.id}) }}" width="100" height="100" class="rounded-circle object-fit-cover">
                                    </div>
                                    
                                    <div class=" mt-3" >
                                        {# <span>
                                            {% for categorie in pro.categorieService %}   
                                    {{ categorie.nom ~ ","}}
                                            {% endfor %}
                                        </span> #}
                                        
                                        <div class="px-4 mt-1">
                                            <p><span class="fw-bolder me-25">Nom:</span>{{ expert.fullName}}</p>
                                            <p>   <span class="fw-bolder me-25">Contact:</span>{{ expert.telephone}}</p>
                                            <p>   <span class="fw-bolder me-25">Email:</span>{{ expert.email}}</p>
                                        
                                        </div>
                                        
                                    
                                        <div class="buttons">
                                        <a href="{{ expert.lienCalendly}}" target="_blank" class="btn btn-primary w-100" href>Prendre rendez-vous</a>
                                        </div>
                                        
                                        
                                    </div> 
                            </div>
                        </div>
                    {% endif %}
                    </div>
                {% endif %}
            </div>
  
            <div class="row match-height mt-4">
                <div class="col-md-12">
                    {{ include ('partials/section/services.html.twig') }}
                </div> 
            </div>

         

            <div class="row match-height mt-4">
                <div class="col-lg-8 col-12">
                    <h4 class=" mt-2 mb-3 choix-secteur-primary only-on-large-screens" style="visibility: hidden;">&nbsp;</h4>
                    {% if app.user.canAccessFonct('PRODUIT', app.session.get('secteurId')) %}
                    <div class="col-lg-12 col-md-12 mb-4">
                        <div class="vision-section rounded-3 pb-1" style="">
                            <div class=" p-0">
                                <div class="row p-5 align-items-center">
                                    <div class="col-md-7 vision-section-1">
                                        <h4 class="general-primary-text fs-2 mb-3">{{secteur.title}}</h4>
                                        <p>
                                            {{secteur.longDescription | raw}}  
                                        </p>
                                        <h6 class="mt-3">
                                        <span class="text-white">Référence :</span> 
                                        <a class="text-dark-template fs-5" href="{{ path('agent_order_list_digital',{'referenceVente' : generateReference(app.user.id,app.user.id) }) }}" >  {{ generateReference(app.user.id,app.user.id) }} </a>
                                        <a class="p-2 text-dark-template fs-5" href="#" onclick="copyLink('{{configSecteurService.getRefUrl(generateReference(app.user.id,app.user.id)) }}','Liens de la référence {{ generateReference(app.user.id,app.user.id) }} copié avec succès') "><i class="fa-solid fa-copy"></i></a> 
                                        </h6>
                                        <a target="_blank" class="vision-button w-100 text-center rounded-3 mt-4 mb-4 mb-md-0 p-3 " href="{{configSecteurService.getRefUrl(generateReference(app.user.id,app.user.id))}}">Voir les catalogues pour le digital</a>    
                                        {# <a target="_blank" href="{{secteur.liens}}" class="card-link">Lien vers {{secteur.nom}}</strong></a> #}
                                    </div>
                                    <div class="col-md-5">
                                            <img src="{{ asset('files/')}}/{{secteur.couverture}}" class="w-100 rounded-3" alt="">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% if app.user.canAccessFonct('AGENDA', app.session.get('secteurId')) %}
                <!-- Developer Meetup Card -->
                <div class="col-lg-4 col-md-6 col-12">
                {% if expert is defined and expert is not null %}
                
                      
                {% endif %}
                
                    <h4 class=" mt-2 mb-3 choix-secteur-primary">Agenda</h4>
                    <div class="card card-developer-meetup position-relative">
                        <div class="position-absolute right-0 top-0 m-3">
                            <a href="{{ path('calendar_index') }}" class="btn btn-primary d-flex justify-content-center align-items-center">Mon Agenda <i data-feather="calendar" class="ms-3"></i></a>
                        </div>
                        <div class="meetup-img-wrapper rounded-top text-center">
                            <img src="{{asset('assets/vuexy/images/illustration/email.svg')}}" alt="Meeting Pic" height="170" />
                        </div>
                        <div class="card-body">
                            {% set day_of_week = { 
                                    "Monday": "Lundi", 
                                    "Tuesday": "Mardi", 
                                    "Wednesday": "Mercredi", 
                                    "Thursday": "Jeudi", 
                                    "Friday": "Vendredi", 
                                    "Saturday": "Samedi", 
                                    "Sunday": "Dimanche" 
                                } 
                            %}
                            {% for event in eventsOfTheDay %}
                            <div class="meetup-header d-flex align-items-center">
                                <div class="meetup-day">
                                    <h6 class="mb-0 text-uppercase">{{day_of_week[event.start|date("l")]}}</h6>
                                    <h3 class="mb-0">{{event.start|date("d")}}</h3>
                                </div>
                                <div class="my-auto">
                                    <h4 class="card-title mb-25">{{event.title}}</h4>
                                    <p class="card-text mb-0">{{event.start|date("\\à g\\hi")}}</p>
                                </div>
                            </div>
                            {% endfor %}
                            {% for event in upcomingEvents %}
                            <div class="mt-0">
                                <div class="avatar float-start bg-light-primary rounded me-1">
                                    <div class="avatar-content">
                                        <i data-feather="calendar" class="avatar-icon font-medium-3"></i>
                                    </div>
                                </div>
                                <div class="more-info">
                                    <h6 class="mb-0">{{event.title}}</h6>
                                    <small>{{event.start|date("d/m/Y \\à g\\hi")}}</small>
                                </div>
                            </div>
                            {% endfor %}
                            {% if upcomingEvents|length == 0 %}
                                <div class="alert alert-secondary">Aucun évenement à venir.</div>
                            {% endif %}
                            {# <div class="meetup-header d-flex align-items-center">
                                <div class="meetup-day">
                                    <h6 class="mb-0">MARDI</h6>
                                    <h3 class="mb-0">24</h3>
                                </div>
                                <div class="my-auto">
                                    <h4 class="card-title mb-25">Rencontre de développeurs</h4>
                                    <p class="card-text mb-0">Rencontrez des développeurs de renommée mondiale</p>
                                </div>
                            </div>
                            <div class="mt-0">
                                <div class="avatar float-start bg-light-primary rounded me-1">
                                    <div class="avatar-content">
                                        <i data-feather="calendar" class="avatar-icon font-medium-3"></i>
                                    </div>
                                </div>
                                <div class="more-info">
                                    <h6 class="mb-0">Samedi, Mai 25, 2020</h6>
                                    <small>10:AM to 6:PM</small>
                                </div>
                            </div>
                            <div class="mt-2">
                                <div class="avatar float-start bg-light-primary rounded me-1">
                                    <div class="avatar-content">
                                        <i data-feather="map-pin" class="avatar-icon font-medium-3"></i>
                                    </div>
                                </div>
                                <div class="more-info">
                                    <h6 class="mb-0">Parc central</h6>
                                    <small>Manhattan, New York</small>
                                </div>
                            </div> #}
                        </div>
                    </div>
                    <div class="card" style="max-height:190px;">
                        <div class="card-body">
                         <div class="row">
                            <div class="col-8">
                                <h5 class="general-primary-text mb-4">Gestion de projet</h5>
                                <p>Accèder à la plateforme pour la suivie de vos projets.</p>
                            </div>
                            <div class="col-4 text-center">
                                <a class="gestion-projet bg-light-primary rounded-circle  d-flex justify-content-center align-items-center" href="{{pixelforce_url}}" >
                                    <i class="fa fa-briefcase fs-1" aria-hidden="true"></i>
                                </a>
                            </div>
                         </div>
                            <a target="_blank" class="regular-button w-100 text-center mt-3 rounded-3 p-3" href="{{pbbAccesClient }}">Accéder à la plateforme</a>    
                        </div>
                    </div>
                </div>
                <!--/ Developer Meetup Card -->
                {% endif %}
                
                {% if app.user.canAccessFonct('RDV', app.session.get('secteurId')) %}
                
                {% endif %}
                 
                
                <!--/ Browser States Card -->
                <!-- Browser States Card -->
                {% if app.user.canAccessFonct('RDV', app.session.get('secteurId')) %}
                {# <div class="col-lg-12 col-12">
                    <div class="card card-company-table p-5" style="min-height: 300px;">
                        <div class="card-head mb-3">
                            <h5>Prenez rendez vous avec un expert</h5>
                            
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table text-center">
                                    <tbody class="align-items-center ">
                                    <tr class="table-header-custom">
                                        <th scope="col">#</th>
                                        <th scope="col">Photo</th>
                                        <th scope="col">Nom et prénoms</th>
                                        <th scope="col">Email</th>
                                        <th scope="col">Téléphone</th>
                                        <th scope="col">Secteur</th>
                                        <th scope="col">ACTION</th>
                                    </tr>
                                    {% for coach in coachs %}
                                            {% set secteurs = repoCoachSecteur.findBy({'coach' : coach}) %}
                                            {% set modal_id = "modal" ~ coach.id %}
                                            
                                            {{include ('partials/modalDedailCoach.html.twig',{coach:coach,secteur:secteurs[0].getSecteur()}) }}

                                            <tr class="justify-content-center align-items-center">
                                                <td>{{ coach.id }}</td>
                                                <td >
                                                    <div class="d-flex align-items-center justify-content-center" type="button" class="btn btn-primary" data-toggle="modal" data-target="#{{modal_id}}">
                                                        <div class="img">
                                                            <img src="{{ path('user_avatar', {id:coach.id}) }}" class="w-50 rounded-3" alt="">
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="text-dark-template " ype="button" class="btn btn-primary" data-toggle="modal" data-target="#{{modal_id}}">{{ coach.fullName }}</td>
                                                <td ><a class="text-tableau" href= "mailto: {{ coach.email }}"> {{ coach.email }} </a></td>
                                                <td ><a class="text-tableau" href="tel:{{ coach.telephone|default('-') }}">{{ coach.telephone|default('-') }}</a></td>
                                                 <td>
                                                    <span class="badge bg-light-warning ">{{ coach.allSecteursOfUser(secteurs)|default('-') }}</span>     
                                                </td>
                                                <td>
                                                    <a class="regular-button text-center rounded-3"  href="#" onclick="Calendly.initPopupWidget({url: '{{coach.getLienCalendly()}}'});return false;" style="min-width:140px;">Prendre RDV </a>
                                                </td>    
                                            </tr>
                      
                                    {% else %}
                                        <tr>
                                            <td class="text-center" colspan="5">Aucun Coach trouvé</td>
                                        </tr>
                                    {% endfor %}

                                    </tbody>
                                </table>
                            </div>
                            <div class="pagination d-flex justify-content-center">
                                    {{ knp_pagination_render(coachs)}}
                            </div>
                        </div>
                    </div>
                </div> #}
                {% endif %}
                <!--/ Browser States Card -->
    
                {# <!-- Goal Overview Card -->
                <div class="col-lg-4 col-md-6 col-12">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h4 class="card-title">Aperçu des objectifs</h4>
                            <i data-feather="help-circle" class="font-medium-3 text-muted cursor-pointer"></i>
                        </div>
                        <div class="card-body p-0">
                            <div id="goal-overview-radial-bar-chart" class="my-2"></div>
                            <div class="row border-top text-center mx-0">
                                <div class="col-6 border-end py-1">
                                    <p class="card-text text-muted mb-0">Terminé</p>
                                    <h3 class="fw-bolder mb-0">786,617</h3>
                                </div>
                                <div class="col-6 py-1">
                                    <p class="card-text text-muted mb-0">En cours</p>
                                    <h3 class="fw-bolder mb-0">13,561</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--/ Goal Overview Card --> #}
    
                {# <!-- Liste Formation -->
                <div class="col-lg-8 col-md-6 col-12">
                    <div class="card card-transaction">
                        <div class="card-header">
                            <h4 class="card-title">Analyse clients</h4>
                            <div class="dropdown chart-dropdown">
                                <i data-feather="more-vertical" class="font-medium-3 cursor-pointer" data-bs-toggle="dropdown"></i>
                                <div class="dropdown-menu dropdown-menu-end">
                                    <a class="dropdown-item" href="#">28 derniers jours</a>
                                    <a class="dropdown-item" href="#">Le mois dernier</a>
                                    <a class="dropdown-item" href="#">L'année dernière</a>
                                </div>
                            </div> 
                        </div>
                        <div class="card-body p-1">
                            {% for client in topClients %}
                            <div class="transaction-item">
                                <div class="d-flex">
                                    <div class="avatar bg-light-primary rounded float-start">
                                        <div class="avatar-content">
                                            <i data-feather="user" class="avatar-icon font-medium-3"></i>
                                        </div>
                                    </div>
                                    <div class="transaction-percentage">
                                        <h6 class="transaction-title">{{client.prenom}} {{client.nom}}</h6>
                                        <small>{{client.email}}</small>
                                    </div>
                                </div>
                                <!-- <div class="fw-bolder text-danger">- $74</div> -->
                                <div class="fw-bolder text-success">{{loop.index}}</div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <!--/ Liste Formation --> #}
            </div>

            <div class="row match-height">
                {# informations statiques  #}
                {# <div class="col-lg-4 col-12">
                    <div class="row match-height">
                        <!-- Bar Chart - Orders -->
                        <div class="col-lg-6 col-md-3 col-6">
                            <div class="card">
                                <div class="card-body pb-50">
                                    <h6>Commandes</h6>
                                    <h2 class="fw-bolder mb-1">2,76k</h2>
                                    <div id="statistics-order-chart"></div>
                                </div>
                            </div>
                        </div>
                        <!--/ Bar Chart - Orders -->
    
                        <!-- Line Chart - Profit -->
                        <div class="col-lg-6 col-md-3 col-6">
                            <div class="card card-tiny-line-stats">
                                <div class="card-body pb-50">
                                    <h6>Profit</h6>
                                    <h2 class="fw-bolder mb-1">6,24k</h2>
                                    <div id="statistics-profit-chart"></div>
                                </div>
                            </div>
                        </div>
                        <!--/ Line Chart - Profit -->
    
                        <!-- Earnings Card -->
                        <div class="col-lg-12 col-md-6 col-12">
                            <div class="card earnings-card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-6">
                                            <h4 class="card-title mb-1">Gains</h4>
                                            <div class="font-small-2">Ce mois-ci</div>
                                            <h5 class="mb-1">$4055.56</h5>
                                            <p class="card-text text-muted font-small-2">
                                                <span class="fw-bolder">68.2%</span><span> plus de revenus que le mois dernier.</span>
                                            </p>
                                        </div>
                                        <div class="col-6">
                                            <div id="earnings-chart"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--/ Earnings Card -->
                    </div>
                </div> #}
    
                {# <!-- Revenue Report Card -->
                <div class="col-lg-12 col-12 ">
                    <div class="card card-revenue-budget">
                        <div class="row mx-0">
                            <div class="col-md-8 col-12 revenue-report-wrapper">
                                <div class="d-sm-flex justify-content-between align-items-center mb-3">
                                    <h4 class="card-title mb-50 mb-sm-0">Rapport sur les revenus</h4>
                                    <!-- <div class="d-flex align-items-center">
                                        <div class="d-flex align-items-center me-2">
                                            <span class="bullet bullet-primary font-small-3 me-50 cursor-pointer"></span>
                                            <span>Gain</span>
                                        </div>
                                        <div class="d-flex align-items-center ms-75">
                                            <span class="bullet bullet-warning font-small-3 me-50 cursor-pointer"></span>
                                            <span>Frais</span>
                                        </div>
                                    </div>  -->
                                </div>
                                <div id="revenue-report-chart"></div>
                            </div>
                            <div class="col-md-4 col-12 budget-wrapper" >
                                <div class="btn-group">
                                    <form method="get" id="form-annee">
                                        <input name="annee" type="hidden" value="{{annee}}" />
                                    </form>
                                    <button type="button" class="btn btn-outline-primary btn-sm dropdown-toggle budget-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <span id="anneeSelected">{{annee}}</span>
                                    </button>
                                    <div class="dropdown-menu" id="anneeContainer">
                                        {% for i in 2020..anneeActuelle %}
                                            <div class="dropdown-item annee-item" data-annee="{{i}}">{{i}}</div>
                                        {% endfor %}
                                        
                                    </div>
                                    
                                    
                                </div>
                                <h2 class="mb-25">{{revenuAnnee.total | number_format(2, ',', ' ')}} €</h2>
                                <!--/<div class="d-flex justify-content-center">
                                    <span class="fw-bolder me-25">Budget:</span>
                                    <span>56,800</span>
                                </div>
                                <div id="budget-chart"></div>
                                <button type="button" class="btn btn-primary">Augmenter le budget</button>
                            </div> -->
                        </div>
                    </div>
                </div>
                <!--/ Revenue Report Card --> #}
            </div>
    
       
        </section>

    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="https://player.vimeo.com/api/player.js"></script>
    <script src="{{asset('app-assets/vendors/js/charts/apexcharts.min.js')}}" defer></script>
    <script type="text/javascript">
        $(window).on('load', function () {
            var revenuAnnee = {{revenuAnnee.result |json_encode() | raw}};
            var data = [];
            var label = [];
            for(let i=0;i<revenuAnnee.length; i++){
                data.push(parseInt(revenuAnnee[i]['montant']));
                label.push(revenuAnnee[i]['mois_str']);
            }

            var $revenueReportChart = document.querySelector('#revenue-report-chart');
            var formAnnee = $('#form-annee');
            var revenueReportChartOptions;
            var revenueReportChart;
            var $textMutedColor = '#b9b9c3';
            var anneeSelected = $('#anneeSelected');


            $('#anneeContainer .annee-item').click(function (e){
                let val = $(this).attr('data-annee');
                anneeSelected.html(val);
                formAnnee.find('input[name="annee"]').val(val);
                formAnnee.submit();
            });

            //------------ Revenue Report Chart ------------
            //----------------------------------------------
            revenueReportChartOptions = {
                chart: {
                height: 230,
                stacked: true,
                type: 'bar',
                toolbar: { show: false }
                },
                plotOptions: {
                bar: {
                    columnWidth: '17%',
                    endingShape: 'rounded'
                },
                distributed: true
                },
                colors: [window.colors.solid.primary, window.colors.solid.warning],
                series: [
                {
                    name: 'Revenu',
                    data: data
                }
                ],
                dataLabels: {
                enabled: false
                },
                legend: {
                show: false
                },
                grid: {
                padding: {
                    top: -20,
                    bottom: -10
                },
                yaxis: {
                    lines: { show: false }
                }
                },
                xaxis: {
                categories: label,
                labels: {
                    style: {
                    colors: $textMutedColor,
                    fontSize: '0.86rem'
                    }
                },
                axisTicks: {
                    show: false
                },
                axisBorder: {
                    show: false
                }
                },
                yaxis: {
                labels: {
                    style: {
                    colors: $textMutedColor,
                    fontSize: '0.86rem'
                    }
                }
                }
            };
            revenueReportChart = new ApexCharts($revenueReportChart, revenueReportChartOptions);
            revenueReportChart.render();

            
        });
       

    </script>
    {% if firstFormation %}
    <script type="text/javascript">
        $(document).ready(function (){
            var iframe = document.getElementById('formationVideo');
            if(formationVideo) {
                const player = new Vimeo.Player(iframe);

                player.on('play', () => {
                    $form= $('#formFinishFormation');
                    if ($form.length){
                        $('#terminerFormationButton').removeClass('d-none');
                        $('#startFormation').addClass('d-none');
                    }
                });
                player.on('ended', () => {
                    console.log('video ended')
                    $('#formFinishFormation').submit();
                });
                player.play();
            }
            
        })

        function terminerFormation(){
             $('#formFinishFormation').submit();
        }
    </script>
    {% endif %}
{% endblock %}